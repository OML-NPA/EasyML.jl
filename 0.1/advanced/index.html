<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advanced · EasyML.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">EasyML.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quick_guide/">Quick guide</a></li><li><a class="tocitem" href="../gui_guide/">GUI guide</a></li><li><a class="tocitem" href="../functions/">Functions</a></li><li class="is-active"><a class="tocitem" href>Advanced</a><ul class="internal"><li><a class="tocitem" href="#Model-data"><span>Model data</span></a></li><li><a class="tocitem" href="#Options"><span>Options</span></a></li><li><a class="tocitem" href="#A-custom-loop"><span>A custom loop</span></a></li></ul></li><li><a class="tocitem" href="../handling_issues/">Handling issues</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Advanced</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Advanced</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/OML-NPA/EasyML.jl/blob/master/docs/src/advanced.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Model-data"><a class="docs-heading-anchor" href="#Model-data">Model data</a><a id="Model-data-1"></a><a class="docs-heading-anchor-permalink" href="#Model-data" title="Permalink"></a></h2><p>A struct named <code>model_data</code> is exported and holds all information about your model.</p><pre><code class="language-julia">mutable struct ModelData
    model::Chain                                       # Flux.jl model.
    layers_info::Vector{AbstractLayerInfo}             # contains information for visualisation of layers.
    loss::Function                                     # holds loss that is used during training and validation.
    input_size::NTuple{3,Int64}                        # model input size.
    output_size::Union{Tuple{Int64},NTuple{3,Int64}}   # model output size.
    classes::Vector{&lt;:AbstractClass}                   # hold information about classes that a neural network outputs and what should be done with them.
    OutputOptions::Vector{&lt;:AbstractOutputOptions}     # hold information about output options for each class for application of the model.
end</code></pre><p><code>loss</code>, <code>classes</code> and <code>OutputOptions</code> fields can be modified manually if needed.</p><p><code>loss</code> can be any function.</p><p><code>classes</code> can be of different types depending on a type of a problem.</p><pre><code class="language-julia">mutable struct ImageClassificationClass&lt;:AbstractClass
    name::String                # name of a class.
    weight::Float32             # weight of a class used for weighted accuracy calculation.
end

mutable struct ImageRegressionClass&lt;:AbstractClass
    name::String                # name of a class.
end

mutable struct ImageSegmentationClass&lt;:AbstractClass
    name::String               # name of a class. It is just for your convenience.
    weight::Float32            # weight of a class used for weighted accuracy calculation.
    color::Vector{Float64}     # RGB color of a class, which should correspond to its color on your images. Uses 0-255 range.
    border::Bool               # allows to train a neural network to recognize borders and, therefore, better separate objects during post-processing.
    border_thickness::Int64    # border thickness in pixels.
    border_remove_objs::Bool   # removes objects that do not have closed borders.
    min_area::Int64            # minimum area of an object.
    parents::Vector{String}    # up to two parents can be specified by their name. Objects from a child are added to its parent.
    not_class::Bool            # specifies that a class is an overlap of two classes and should be just added to specified parents.
end</code></pre><p><code>OutputOptions</code> should also be chosen accordingly to a type of a problem one has.</p><p><code>ImageClassificationOutputOptions</code> and <code>ImageRegressionOutputOptions</code> are currently empty. New functionality can be added on request.</p><pre><code class="language-julia">@with_kw mutable struct ImageSegmentationOutputOptions&lt;:AbstractOutputOptions
    Mask::OutputMask            # holds output mask options.
    Area::OutputArea            # holds area of objects options.
    Volume::OutputVolume        # holds volume of objects options.
end

mutable struct OutputMask
    mask::Bool                  # exports a mask after applying all processing except for border data.
    mask_border::Bool           # exports a mask with class borders if a class has border detection enabled.
    mask_applied_border::Bool   # exports a mask processed using border data.
end

@with_kw mutable struct OutputArea
    area_distribution::Bool     # exports area distribution of detected objects as a histogram.
    obj_area::Bool              # exports area of each detected object.
    obj_area_sum::Bool          # exports sum of all areas for each class.
    binning::Int64              # specifies a binning method; 0 - automatic, 1 - number of bins, 2 - bin width.
    value::Float64              # number of bins or bin width depending on a previous settings.
    normalisation::Int64        # normalisation type for a histogram, 0 - pdf, 1 - Density, 2 - Probability, 3 - None.
end

@with_kw mutable struct OutputVolume
    volume_distribution::Bool   # exports volume distribution of detected objects as a histogram.
    obj_volume::Bool            # exports volume of each detected object.
    obj_volume_sum::Bool        # exports sum of all volumes for each class.
    binning::Int64              # specifies a binning method; 0 - automatic, 1 - number of bins, 2 - bin width.
    value::Float64              # number of bins or bin width depending on a previous settings.
    normalisation::Int64        # normalisation type for a histogram, 0 - pdf, 1 - Density, 2 - Probability, 3 - None.
end</code></pre><p>Example code for a segmentation problem.</p><pre><code class="language-julia">class1 = ImageSegmentationClass(name = &quot;Cell&quot;, weight = 1, color = [0,255,0], border = true, 
    border_thickness = 5, border_remove_objs = true, min_area = 50)
class2 = ImageSegmentationClass(name = &quot;Vacuole&quot;, weight = 1, color = [255,0,0], border = false, 
    border_thickness = 5, border_remove_objs = true, min_area = 5, parents = [&quot;Cell&quot;,&quot;&quot;])

class_output_options1 = ImageSegmentationOutputOptions()
class_output_options2 = ImageSegmentationOutputOptions()

settings.problem_type = :Segmentation
classes = [class1,class2]
output_options = [class_output_options1,class_output_options2]
model_data.classes = classes
model_data.OutputOptions = output_options</code></pre><h2 id="Options"><a class="docs-heading-anchor" href="#Options">Options</a><a id="Options-1"></a><a class="docs-heading-anchor-permalink" href="#Options" title="Permalink"></a></h2><p>All options are located in <code>EasyML.options</code>.</p><pre><code class="language-julia">mutable struct Options
    GlobalOptions::GlobalOptions
    DesignOptions::DesignOptions
    TrainingOptions::TrainingOptions
    ApplicationOptions::ApplicationOptions
end</code></pre><pre><code class="language-julia">mutable struct GlobalOptions
    Graphics::Graphics
    HardwareResources::HardwareResources
end</code></pre><p>Can be accessed as <code>EasyML.global_options</code>.</p><pre><code class="language-julia">mutable struct HardwareResources
    allow_GPU::Bool      # allows to use a GPU if a compatible one is installed.
    num_threads::Int64   # a number of CPU threads that will be used.
    num_slices::Int64    # allows to process images during validation and application that otherwise cause an out of memory error by slicing them into multiple parts. Used only for segmentation.
    offset::Int64        # offsets each slice by a given number of pixels to allow for an absence of a seam. 
end</code></pre><p>Can be accessed as <code>EasyML.hardware_resources</code>.</p><pre><code class="language-julia">mutable struct Graphics
    scaling_factor::Float64   # scales GUI by a given factor.
end</code></pre><p>Can be accessed as <code>EasyML.graphics</code>.</p><pre><code class="language-julia">@with_kw mutable struct DesignOptions
    width::Float64        # width of layers
    height::Float64       # height of layers
    min_dist_x::Float64   # minimum horizontal distance between layers
    min_dist_y::Float64   # minimum vertical distance between layers
end</code></pre><p>Can be accessed as <code>EasyML.design_options</code>.</p><pre><code class="language-julia">@with_kw mutable struct TrainingOptions
    Accuracy::AccuracyOptions
    Testing::TestingOptions
    Processing::ProcessingOptions
    Hyperparameters::HyperparametersOptions
end</code></pre><p>Can be accessed as <code>EasyML.training_options</code>.</p><pre><code class="language-julia">mutable struct AccuracyOptions 
    weight_accuracy::Bool   # uses weight accuracy where applicable.
    accuracy_mode::Symbol   # either :Auto or :Manual. :Manual allows to specify weights manually for each class.
end</code></pre><p>Can be accessed as <code>EasyML.accuracy_options</code>.</p><pre><code class="language-julia">mutable struct TestingOptions
    test_data_fraction::Float64     # a fraction of data from training data to be used for testing if data preparation mode is set to :Auto.
    num_tests::Float64              # a number of tests to be done each epoch at equal intervals.
    data_preparation_mode::Symbol   # Either :Auto or :Manual. Auto takes a specified fraction of training data to be used for testing. Manual allows to use other data as testing data.
end</code></pre><p>Can be accessed as <code>EasyML.testing_options</code>.</p><pre><code class="language-julia">mutable struct ProcessingOptions
    grayscale::Bool       # converts images to grayscale for training, validation and application.
    mirroring::Bool       # augments data by producing horizontally mirrored images.
    num_angles::Int64     # augments data by rotating images using a specified number of angles. 1 means no rotation, only an angle of 0.
    min_fr_pix::Float64   # if supplied images are bigger than a model&#39;s input size, then an image is broken into chunks with a correct size. This option specifies the minimum number of labeled pixels for these chunks to be kept.
end</code></pre><p>Can be accessed as <code>EasyML.processing_options</code>.</p><pre><code class="language-julia">mutable struct HyperparametersOptions
    optimiser::Symbol                   # an optimiser that should be used during training. ADAM usually works well for all cases.
    optimiser_params::Vector{Float64}   # parameters specific for each optimiser. Default ones can be found in EasyML.training_options_data
    learning_rate::Float64              # pecifies how fast a model should train. Lower values - more stable, but slower. Higher values - less stable, but faster. Should be decreased as training progresses.
    epochs::Int64                       # a number of rounds for which a model should be trained.
    batch_size::Int64                   # a number of data that should be batched together during training.
end</code></pre><p>Can be accessed as <code>EasyML.hyperparameters_options</code>.</p><h2 id="A-custom-loop"><a class="docs-heading-anchor" href="#A-custom-loop">A custom loop</a><a id="A-custom-loop-1"></a><a class="docs-heading-anchor-permalink" href="#A-custom-loop" title="Permalink"></a></h2><p>A custom loop can be written using <code>forward</code>.</p><p>Example code for a segmentation problem.</p><pre><code class="language-julia">model = model_data.model
data = [ones(Float32,160,160,3,1)]   # vector with your data goes here
results = Vector{BitArray{3}}(undef,0)
for i = 1:length(data)
    output_raw = forward(model,data[i])
    output_bool = output_raw[:,:,:].&gt;0.5
    output = apply_border_data(output_bool,model_data.classes)   # can be removed if your model does not detect borders
    push!(results,output)
end</code></pre><article class="docstring"><header><a class="docstring-binding" id="EasyML.forward" href="#EasyML.forward"><code>EasyML.forward</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">forward(model::Chain, input_data::Array{Float32}; num_slices::Int64=1, offset::Int64=20, use_GPU::Bool=false)</code></pre><p>The function takes in a model and input data and returns output from that model. <code>num_slices</code> specifies in how many  slices should an array be run thorugh a neural network. Allows to process images that otherwise cause an out of memory error. <code>offset</code> specifies the size of an overlap that should be taken from the left and right side of each slice to allow for  an absense of a seam. <code>use_GPU</code> enables or disables GPU usage.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="EasyML.apply_border_data" href="#EasyML.apply_border_data"><code>EasyML.apply_border_data</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">apply_border_data(input_data::BitArray{3},classes::Vector{ImageSegmentationClass})</code></pre><p>Used for segmentation. Uses borders of objects that a neural network detected in order  to separate objects from each other. Output from a neural network should be fed after  converting to BitArray.</p></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../functions/">« Functions</a><a class="docs-footer-nextpage" href="../handling_issues/">Handling issues »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 28 June 2021 23:03">Monday 28 June 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
